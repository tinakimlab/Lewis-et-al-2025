
#libraries
```{r}
library(tidyverse)
library(tcltk2)
library(lubridate)
library(stringr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(extrafont)
  #font_import()
  loadfonts(device = "postscript")
```
#filling in table
```{r}
#blue light or orange light sides
light_side <-c("d3chr1" = "left", "d3chr2" = "right", "d3chr3"="left", "d3chr4"= "left", "d3chr5"="right", "d3chr6" = "right", "d3gcamp27"="right", "d3gcamp28"="left", "d3chr7"="right", "d3chr8"= "right", "d3chr9"="left", "d3chr10"="left", "d3gcamp31"="left", "d3gcamp33"="right", "d3gcamp34"="right", "d1spark1"="left", "d1spark2"="left", "d1spark3"="right", "d1spark4"="right", "d1spark5"="left", "d1spark6"="left", "d1spark7"="right", "d1spark8"="right", "d3chr11"="left", "d3chr12"="left", "d3chr13"="right", "d3chr14"="right", "d3chr15"="right", "d3chr16"="left", "d3chr17"="left", "d3chr18"="left", "wtchr1"="right", "wtchr3"="left", "wtchr4"="right", "wtchr5"="right", "d3gcamp36"="right", "d3gcamp38"="left", "d3gcamp39"="left", "d3chr19"="left", "d3chr20"="right", "d3chr21"="right", "d3chr22"="left", "d3chr26"="right", "d3chr27"="right", "d3chr28"="left", "d3halo1"="left", "d3halo2"="right", "d3halo3"="left", "d3halo4"="right", "d3halo5"="right", "d3halo6"="left", "d3gcamp43"="left", "d3gcamp44"="left", "d3halo7"="left", "d3halo8"="right", "d3halo9"="right", "d3halo10"="right", "wtchr6"="left", "wtchr7"="right", "wtchr8"="right", "wtchr9"="right", "wtchr10"="left", "d3gcamp40"="left", "d3gcamp41"="left", "d3gcamp42"="right", "d3chr24"="right", "d3chr25"="left", "d3chr29"="right", "d3chr23"="right", "D1spark1"="left", "D1spark3"="right", "D1spark4"="left", "D1spark5"="right", "D1spark6"="left", "D1spark7"="right", "d3halo12"="left", "d3halo13"="right", "d3halo14"="left", "d3halo16"="left", "d3halo17"="left", "d3halo18"="right", "d3yfp1"="right", "d3yfp3"="left", "d3yfp4"="right", "d3yfp5"="left", "d3yfp6"="right", "d3chr30"="left", "d3chr31"="right", "d3chr32"="right", "d3chr33"="left", "d3chr34"="right", "d3chr35"="left", "wtspark2"="right", "wtspark3"="left", "wtspark4"="left", "wtspark5"="left", "wtspark6"="right", "wtspark7"="right", "wtspark8"="right", "wtspark9"="right", "wtspark10"="left", "d1crespark1"="right", "d1crespark2"="left", "d1crespark3"="right", "d1crespark4"="left", "d1crespark5"="right", "d1crespark6"="left", "d1crespark7"="left", "d1crespark8"="right", "d1crespark9"="left", "d1crespark10"="right", "d1crespark11"="left", "d1crespark12"="right", "d1crespark13"="left", "d1crespark14"="right", "d1crespark15"="left", "spark3"="left", "spark5"="left", "spark7"="right", "spark9"="right", "d3halo20"="right", "d3halo21"="right", "d3halo22"="left", "d3halo24"="right", "d3halo25"="left", "d3halo26"="left", "bluecontrol20"="right", "bluecontrol22"="left", "d3gcamp50"="left", "d3gcamp51"="left", "d3gcamp52"="right", "d3gcamp53"="right", "d3gcamp54"="left")

#add a column for brain region
subregion <- c("d3chr1" = "med", "d3chr2" = "med", "d3chr3"="med", "d3chr4"= "med", "d3chr5"="med", "d3chr6" = "med", "d3chr7"="med", "d3chr8"="med", "d3chr9"="med", "d3chr10"="med", "d3gcamp27"= "med", "d3gcamp28"="med", "d3gcamp31"="med", "d3gcamp33"="med", "d3gcamp34"="med", "wtchr1"="med", "wtchr3"="med", "wtchr4"="med", "wtchr5"="med", "d3gcamp36"="med", "d3gcamp38"="med", "d3gcamp39"="med", "d3chr19"="lat", "d3chr20"="lat", "d3chr21"="lat", "d3chr22"="lat", "d3chr26"="lat", "d3chr27"="lat", "d3chr28"="lat", "d3halo1"="lat", "d3halo2"="lat", "d3halo3"="lat", "d3halo4"="lat", "d3halo5"="lat", "d3halo6"="lat", "d3gcamp43"="lat", "d3gcamp44"="lat", "d3halo7"="lat", "d3halo8"="lat", "d3halo9"="lat", "d3halo10"="lat", "wtchr8"="lat", "wtchr9"="lat", "wtchr6"="lat", "wtchr7"="lat", "wtchr10"="lat", "d3gcamp40"="lat", "d3gcamp42"="lat", "d3chr24"="lat", "d3chr25"="lat", "d3chr29"="lat", "d3chr23"="lat", "d3halo12"="med", "d3halo13"="med", "d3halo14"="med", "d3halo16"="med", "d3halo17"="med", "d3halo18"="med", "d3chr30"="med", "d3chr31"="med", "d3chr32"="med", "d3chr33"="med", "d3chr34"="med", "d3chr35"="med", "d3yfp1"="lat", "d3yfp3"="lat", "d3yfp4"="lat", "d3yfp5"="lat", "d3yfp6"="lat", "spark3"="lat", "spark5"="lat", "spark7"="lat", "spark9"="lat", "d3halo20"="med", "d3halo21"="med", "d3halo22"="med", "d3halo24"="med", "d3halo25"="med", "d3halo26"="med", "bluecontrol20"="lat", "bluecontrol22"="lat", "d3gcamp50"="med", "d3gcamp51"="med", "d3gcamp52"="med", "d3gcamp53"="med", "d3gcamp54"="med" )

#add a column for genotype
genotype <- c("d3chr1" = "d3cre", "d3chr2" = "d3cre", "d3chr3"="d3cre", "d3chr4"= "d3cre", "d3chr5"="d3cre", "d3chr6" = "d3cre", "d3chr7"="d3cre", "d3chr8"="d3cre", "d3chr9"="d3cre", "d3chr10"="d3cre", "d3gcamp27"= "d3cre", "d3gcamp28"="d3cre", "d3gcamp31"="d3cre", "d3gcamp33"="d3cre", "d3gcamp34"="d3cre", "wtchr1"="wt", "wtchr3"="wt", "wtchr4"="wt", "wtchr5"="wt", "d3gcamp36"="d3cre", "d3gcamp38"="d3cre", "d3gcamp39"="d3cre", "d3chr19"="d3cre", "d3chr20"="d3cre", "d3chr21"="d3cre", "d3chr22"="d3cre", "d3chr26"="d3cre", "d3chr27"="d3cre", "d3chr28"="d3cre", "d3halo1"="d3cre", "d3halo2"="d3cre", "d3halo3"="d3cre", "d3halo4"="d3cre", "d3halo5"="d3cre", "d3halo6"="d3cre", "d3gcamp43"="d3cre", "d3gcamp44"="d3cre", "d3halo7"="d3cre", "d3halo8"="d3cre", "d3halo9"="d3cre", "d3halo10"="d3cre", "wtchr8"="wt", "wtchr9"="wt", "wtchr6"="wt", "wtchr7"="wt", "wtchr10"="wt", "d3gcamp40"="d3cre", "d3gcamp42"="d3cre", "d3chr24"="d3cre", "d3chr25"="d3cre", "d3chr29"="d3cre", "d3chr23"="d3cre", "d3halo12"="d3cre", "d3halo13"="d3cre", "d3halo14"="d3cre", "d3halo16"="d3cre", "d3halo17"="d3cre", "d3halo18"="d3cre", "d3chr30"="d3cre", "d3chr31"="d3cre", "d3chr32"="d3cre", "d3chr33"="d3cre", "d3chr34"="d3cre", "d3chr35"="d3cre", "d3yfp1"="d3cre", "d3yfp3"="d3cre", "d3yfp4"="d3cre", "d3yfp5"="d3cre", "d3yfp6"="d3cre", "spark3"="d3cre", "spark5"="d3cre", "spark7"="d3cre", "spark9"="d3cre", "d3halo20"="d3cre", "d3halo21"="d3cre", "d3halo22"="d3cre", "d3halo24"="d3cre", "d3halo25"="d3cre", "d3halo26"="d3cre", "bluecontrol20"="d3cre", "bluecontrol22"="d3cre", "d3gcamp50"="d3cre", "d3gcamp51"="d3cre", "d3gcamp52"="d3cre", "d3gcamp53"="d3cre", "d3gcamp54"="d3cre")

#separate controls from experimental mice
Group <-c("d3chr1" = "chr", "d3chr2" = "chr", "d3chr3"="chr", "d3chr4"= "chr", "d3chr5"="chr", "d3chr6" = "chr", "d3chr7"="chr", "d3chr8"="chr", "d3chr9"="chr", "d3chr10"="chr", "d3gcamp27"= "yfpblue", "d3gcamp28"="yfpblue", "d3gcamp31"="yfpblue", "d3gcamp33"="yfpblue", "d3gcamp34"="yfpblue","d1spark1"="fentanyl", "d1spark2"="control", "d1spark3"="fentanyl", "d1spark4"="control", "d1spark5"="fentanyl", "d1spark6"="control", "d1spark7"="fentanyl", "d1spark8"="control", "d3chr11"="d3chr", "d3chr12"="d3chr", "d3chr13"="d3chr", "d3chr14"="d3chr", "d3chr15"="d3chr", "d3chr16"="d3chr", "d3chr17"="d3chr", "d3chr18"="d3chr", "wtchr1"="wtchr", "wtchr3"="wtchr", "wtchr4"="wtchr", "wtchr5"="wtchr", "d3gcamp36"="yfpblue", "d3gcamp38"="yfpblue", "d3gcamp39"="yfpblue", "d3chr19"="chr", "d3chr20"="chr", "d3chr21"="chr", "d3chr22"="chr", "d3chr26"="chr", "d3chr27"="chr", "d3chr28"="chr", "d3halo1"="halo", "d3halo2"="halo", "d3halo3"="halo", "d3halo4"="halo", "d3halo5"="halo", "d3halo6"="halo", "d3gcamp43"="yfporange", "d3gcamp44"="yfporange", "d3halo7"="halo", "d3halo8"="halo", "d3halo9"="halo", "d3halo10"="halo", "wtchr8"="wtchr", "wtchr9"="wtchr", "wtchr6"="wtchr", "wtchr7"="wtchr", "wtchr10"="wtchr", "d3gcamp40"="yfpblue", "d3gcamp42"="yfpblue", "d3chr24"="chr", "d3chr25"="chr", "d3chr29"="chr", "d3chr23"="chr", "D1spark1"="fentanyl", "D1spark3"="saline", "D1spark4"="saline", "D1spark5"="fentanyl", "D1spark6"="fentanyl", "D1spark7"="fentanyl", "d3halo12"="halo", "d3halo13"="halo", "d3halo14"="halo", "d3halo16"="halo", "d3halo17"="halo", "d3halo18"="halo", "d3chr30"="chr", "d3chr31"="chr", "d3chr32"="chr", "d3chr33"="chr", "d3chr34"="chr", "d3chr35"="chr", "wtspark2"="fentanyl", "wtspark3"="saline", "wtspark4"="fentanyl", "wtspark5"="saline", "wtspark6"="fentanyl", "wtspark7"="saline", "wtspark8"="fentanyl", "wtspark9"="saline", "wtspark10"="fentanyl", "d1crespark1"="saline", "d1crespark2"="fentanyl", "d1crespark3"="saline", "d1crespark4"="fentanyl", "d1crespark5"="saline", "d1crespark6"="fentanyl", "d1crespark7"="saline", "d1crespark8"="fentanyl", "d1crespark9"="saline", "d1crespark10"="fentanyl", "d1crespark11"="saline", "d1crespark12"="fentanyl", "d1crespark13"="saline", "d1crespark14"="fentanyl", "d1crespark15"="fentanyl", "spark3"="yfporange", "spark5"="yfporange", "spark7"="yfporange", "spark9"="yfporange", "d3halo20"="halo", "d3halo21"="halo", "d3halo22"="halo", "d3halo24"="halo", "d3halo25"="halo", "d3halo26"="halo", "bluecontrol20"="yfpblue", "bluecontrol22"="yfpblue", "d3gcamp50"="yfporange", "d3gcamp51"="yfporange", "d3gcamp52"="yfporange", "d3gcamp53"="yfporange", "d3gcamp54"="yfporange")
```


#input files X and Y
```{r}

# ##input track files
setwd(tk_choose.dir(caption = "Where is your data?"))
filenames <- list.files(getwd())
filenames <- filenames[grepl(".csv$", filenames)]
track_data <- list()

for (i in 1:length(filenames)) {

  #import raw .csv
  track_raw <- read.csv(filenames[i], header = TRUE, skip = 1) 

  # make fresh data frame
  df_raw <- data.frame(
    time_ms = track_raw$TimeStamp[1:nrow(track_raw)],
    Position = track_raw$Position[1:nrow(track_raw)]
  )
  df_raw <- na.omit(df_raw)
  
  df_raw <- df_raw %>%
    dplyr:: mutate(mins = time_ms/60000) %>%
    dplyr:: mutate(file = filenames[i]) %>%
    extract(file, c("Mouse", "Date", "Treatment", "Filetype"), "([[:alnum:]]+)_([.[:alnum:]]+)_([[:alnum:]]+)_([.[:alnum:]]+)", remove = T) %>%  
  unite(datemouse, Date, Mouse, remove = F) %>%
  unite(treatmentmouse, Treatment, Mouse, remove = F) %>%
  dplyr:: mutate(Date = mdy(Date)) 

  df_raw <- data.frame(df_raw) 

  track_data[[i]] <- df_raw %>% 
    dplyr::left_join(data.frame(Mouse = names(light_side), light_side = light_side), by = "Mouse")
}

all_data_xy <- bind_rows(track_data)  %>%
      distinct(time_ms, .keep_all = TRUE)#could downsample here

#duds
# duds <- c("d3chr14", "d3halo8", "d3gcamp41", "d3halo17")
# all_data_xy <- all_data_xy %>%
#   filter(!str_detect(Mouse, paste(duds, collapse = "|"))) 

# Add a column for Group, subregion, and genotype to data frame
all_data_xy <- all_data_xy %>% 
  drop_na(light_side) %>% 
  left_join(data.frame(Mouse = names(Group), Group = Group), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse") %>% 
  left_join(data.frame(datemouse = names(yfp_group), yfp_group = yfp_group), by = "datemouse")

#find and replace rtpa1 with rtpa
all_data_xy <- all_data_xy %>%
  mutate(Treatment = case_when(
    Treatment == "rtpa1" ~ "rtpa",
    Treatment == "baseline" ~ "baseline",
    TRUE ~ as.character(Treatment) # Keep other values unchanged
  ))

# Extract X and Y coordinates
all_data_xy <- all_data_xy %>%
  mutate(X = as.numeric(str_extract(Position, "\\d+(?=;)")),   
         Y = as.numeric(str_extract(Position, "(?<=;)\\d+"))) %>%
  drop_na(Position) %>%
  mutate(current_side = case_when(
    X > 800 ~ "right",
    X < 750 ~ "left",
    X >= 750 & X <= 800 ~ "doorway"
  ))

#ADD IN FOR DOUBLE YFP MICE

# # Filter rows with Treatment as 'baseline'
# baseline_rows <- all_data_xy %>% filter(Treatment == "baseline")
# 
# # Modify the yfp_group column to 'yfpblue'
# baseline_rows$yfp_group <- "yfpblue"
# 
# # Combine the modified rows with the original data
# all_data_xy <- bind_rows(all_data_xy, baseline_rows)
```

#input ROIs from RWD
```{r}
library(readxl)
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/RWD Data/")
RWD_OFRS_ROIs <- read_excel("/Users/Elly/Desktop/Kim Lab-Whistler Lab/RWD Data/RWD_OFRS_ROIs.xlsx", sheet = 1)

#change sheet if needed

all_data <- RWD_OFRS_ROIs

# Add a column for Group, subregion, and genotype to data frame
all_data <- all_data %>% 
  left_join(data.frame(Mouse = names(Group), Group = Group), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(light_side), light_side = light_side), by = "Mouse")%>%
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>%
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse")

#calculate percent time light side

all_data <- all_data %>%
  group_by(Mouse, Treatment) %>%
  mutate(ROI1 = as.numeric(ROI1),
    RO12 = as.numeric(RO12),
    PercentageTimeLightSide = if_else(
      light_side == "left",
      ROI1 / 1800,
      RO12 / 1800)) %>%
  filter(Mouse!="d1spark4")%>%
   filter(Mouse!="d1spark7")%>%
   filter(Mouse!="d1spark10")%>%
   filter(Mouse!="d1spark14")

# Identify the mice that have three different levels under Treatment
mice_with_three_levels <- all_data %>%
  group_by(Mouse) %>%
  filter(n_distinct(Treatment) == 3) %>%
  pull(Mouse) %>%
  unique()

# Filter the rows with Treatment == "baseline" for these mice
baseline_rows <- all_data %>%
  filter(Mouse %in% mice_with_three_levels & Treatment == "baseline")

# Create the new rows with Group == "yfpblue" and "yfporange"
new_rows_yfpblue <- baseline_rows %>%
  mutate(Group = "yfpblue", Treatment = "baseline")

new_rows_yfporange <- baseline_rows %>%
  mutate(Group = "yfporange", Treatment = "baseline")

all_data <- all_data %>%
  bind_rows(new_rows_yfpblue, new_rows_yfporange) %>%
  mutate(
    Group = case_when(
      Treatment == "yfporange" ~ "yfporange",
      Treatment == "yfpblue" ~ "yfpblue",
      TRUE ~ Group  ),
    Treatment = case_when(
      Treatment == "yfpblue" ~ "rtpa",
      Treatment == "yfporange" ~ "rtpa",
      TRUE ~ Treatment  )) %>%
  drop_na(Group)  
```

#percents with x and y
```{r}

# Initialize an empty data frame to store results
percentage_xy <- data.frame()

all_data_xy <- all_data_xy %>% filter(mins <= 15)

# Loop through each mouse
for (current_datemouse in unique(all_data_xy$datemouse)) {
  
  # Loop through each treatment for the current mouse
  for (current_treatment in unique(all_data_xy$Treatment[all_data_xy$datemouse == current_datemouse])) {
    
    # Subset the data for the current mouse and treatment
    subset_data <- all_data_xy[all_data_xy$datemouse == current_datemouse & all_data_xy$Treatment == current_treatment, ]
    
    # Calculate the percentage of time on the light side for each treatment and mouse
    percentage_temp <- subset_data %>%
      group_by(Mouse, Treatment, light_side, datemouse) %>%
      summarise(PercentageTimeLightSide = sum(current_side == light_side, na.rm = TRUE) / n(), .groups = 'keep')
    
    # Append results to percentage_xy
    percentage_xy <- bind_rows(percentage_xy, percentage_temp)
  }
}

#Add a column for Group to the data frame
percentage_xy <- percentage_xy %>%
  left_join(data.frame(Mouse = names(Group), Group = Group), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse")



# #for YFP double mice
# # Filter rows with Treatment as 'baseline'
# baseline_rows <- percentage_xy %>% filter(Treatment == "baseline")
# 
# # Modify the yfp_group column to 'yfpblue'
# baseline_rows$yfp_group <- "yfpblue"
# 
# # Combine the modified rows with the original data
# percentage_xy <- bind_rows(percentage_xy, baseline_rows)
```

#fold changes
```{r}
# Define the fold change function
fold_change <- function(baseline, rtpa) {
  return(rtpa / baseline)
}

# Initialize a data frame to store results
fold_changes <- data.frame()

# Create a unique combination of Mouse and Group
unique_combinations <- all_data %>%
  dplyr::select(Mouse, Group) %>%
  distinct()

# Loop over unique combinations of Mouse and Group
for (i in 1:nrow(unique_combinations)) {
  m <- unique_combinations$Mouse[i]
  g <- unique_combinations$Group[i]

  # Subset data for the current combination
  subset_data <- all_data[all_data$Mouse == m & all_data$Group == g, ]

  baseline_percent <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "baseline"]
  rtpa_percent <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "rtpa"]

  # Check if we have values for both baseline and rtpa
  if (length(baseline_percent) > 0 && length(rtpa_percent) > 0) {
    # Take the first value if there are multiple entries
    baseline_value <- baseline_percent[1]
    rtpa_value <- rtpa_percent[1]

    fc <- fold_change(baseline_value, rtpa_value)

    fold_change_entry <- data.frame(Mouse = m, fold_change = fc, Group= g)

    fold_changes <- rbind(fold_changes, fold_change_entry)
  }
}

fold_changes <- fold_changes %>% 
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(light_side), light_side = light_side), by = "Mouse")

#mean fold changes
mean_fold <- fold_changes %>%  filter(Mouse!="d3halo14") %>%
  group_by(Group, subregion, genotype) %>%
  summarize(
    mean_fold_change = mean(fold_change, na.rm = TRUE),
    sd = sd(fold_change, na.rm = TRUE),
    n = n()
  ) %>%
  mutate(sem = sd / sqrt(n)) %>%
  ungroup()


```


#sample trace and heatmap
```{r}

light_color <- c("chr"= "blue", "wtchr"="blue", "yfporange"="orange", "halo"="orange", "yfpblue"="blue")

sample <- all_data_xy

# Individual Mouse traces
unique_treatmentmouse <- unique(sample$treatmentmouse)

for (i in 1:length(unique_treatmentmouse)) {
  treatment <- unique_treatmentmouse[i]
  subset_data <- sample[sample$treatmentmouse == treatment,]
  
  plot <- ggplot(subset_data, aes(x = X, y = Y)) +
    geom_path() +
    theme_classic() + 
    ggtitle(paste("Treatment:", treatment))
  
  print(plot)
}

```

#locomotion
```{r}
euclidean_distance <- function (X1, Y1, X2, Y2) {
  
  return(sqrt(abs((X2-X1)^2 + (Y2-Y1)^2)))
  
}

# #exclude mice with bad tracking
# accurate_tracking_data <- all_data_xy %>%
#   mutate(accurate_tracking = case_when(
#     str_detect(Mouse, "d3chr29") |
#     str_detect(Mouse, "d3halo7") &
#     str_detect(Treatment, "baseline") ~ FALSE, 
#     str_detect(Mouse, "d3chr28") |
#     str_detect(Mouse, "d3halo3") &
#     str_detect(Treatment, "rtpa1") ~ FALSE,
#     TRUE ~ TRUE # Set other cases to TRUE, meaning they are accurate_tracking
#   )) %>% filter((accurate_tracking)) 

# Keep the first row for each treatmentmouse group and then every 13th row
downsampled_data <- all_data_xy %>%
  group_by(datemouse) %>%
  slice(c(1, seq(13, n(), by = 13))) 

# Initialize a list to store the total locomotion for each datemouse entry
total_locomotion <- vector("numeric", length = length(unique(downsampled_data$datemouse)))

# Loop through each unique datemouse entry
for (i in seq_along(unique(downsampled_data$datemouse))) {
  datemouse_entry <- unique(downsampled_data$datemouse)[i]
  
  # Subset the data for the current datemouse entry
  subset_data <- downsampled_data[downsampled_data$datemouse == datemouse_entry, ]
  
  # Displacement for each time step within the subset
  displacement <- c(0) # Displacement at t=0 is 0
  
  for (j in 2:nrow(subset_data)) { 
    each_displacement <- euclidean_distance(subset_data$X[j-1], subset_data$Y[j-1], subset_data$X[j], subset_data$Y[j])
    displacement <- c(displacement, each_displacement)
       
  }
  
  # Calculate the total locomotion for the current datemouse entry
  total_locomotion[i] <- sum(displacement, na.rm=TRUE)
  
}

# Create a data frame with datemouse and total locomotion
total_locomotion_df <- data.frame(
  datemouse = unique(downsampled_data$datemouse),
  total_locomotion = total_locomotion
)

#join to percent xy data frame
locomotion_data <- left_join(total_locomotion_df, percentage_xy, by = "datemouse") %>%
  left_join(data.frame(Mouse = names(Group), Group = Group), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse") %>% 
  left_join(data.frame(datemouse = names(yfp_group), yfp_group = yfp_group), by = "datemouse")

# plot
med_data <- locomotion_data %>% filter(subregion=="med")

lat_data <- locomotion_data %>% filter(subregion=="lat")


ggplot(med_data, aes(x = Treatment, y = total_locomotion, fill = Group)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  labs(title = "Total Locomotion by Treatment, Subregion, Group, and Genotype",
       x = "Treatment",
       y = "Total Locomotion",
       fill = "Subregion")

ggplot(lat_data, aes(x = Treatment, y = total_locomotion, fill = Group)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  labs(title = "Total Locomotion by Treatment, Subregion, Group, and Genotype",
       x = "Treatment",
       y = "Total Locomotion",
       fill = "Subregion")

```


#graphs to visualize
```{r}

all_data_med <- all_data %>% filter(subregion=="med")
ggplot(all_data_med, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group, color=subregion),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

all_data_lat <- all_data %>% filter(subregion=="lat")
ggplot(all_data_lat, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group, color=subregion),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

ggplot(all_data, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

#baseline v day 1 light lines
halo_data <- all_data %>% filter(subregion=="lat") %>% filter(Group=="halo")
ggplot(data=halo_data, aes(x = Treatment, y = PercentageTimeLightSide, color = Group)) +
  geom_point( aes(group = Group, fill = Group), position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2), size=0.2) +
  geom_text(aes(label = Mouse), position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2), vjust = -0.5) + 
  geom_line(aes(x = Treatment, y = PercentageTimeLightSide, group = Mouse), alpha = 0.7) +
  theme_classic() +
  scale_color_manual(values=c("blue", "orange", "forestgreen", "cornflowerblue", "brown")) +
  scale_y_continuous(limits=c(0, 0.8)) +
  ggtitle("baseline v RTPA1")

all_data_med <- percentage_xy %>% filter(subregion=="med")
ggplot(all_data_med, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group, color=subregion),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

all_data_lat <- percentage_xy %>% filter(subregion=="lat")
ggplot(all_data_lat, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group, color=subregion),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

ggplot(percentage_xy, aes(x=Treatment, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) + geom_point(aes(fill=Group),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) +
  theme_classic() +
  ggtitle("baseline v RTPA1")

#baseline v day 1 light lines
halo_data <- percentage_xy %>% filter(subregion=="lat") %>% filter(Group=="halo")
ggplot(data=halo_data, aes(x = Treatment, y = PercentageTimeLightSide, color = Group)) +
  geom_point( aes(group = Group, fill = Group), position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2), size=0.2) +
  geom_text(aes(label = Mouse), position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2), vjust = -0.5) + 
  geom_line(aes(x = Treatment, y = PercentageTimeLightSide, group = Mouse), alpha = 0.7) +
  theme_classic() +
  scale_color_manual(values=c("blue", "orange", "forestgreen", "cornflowerblue", "brown")) +
  scale_y_continuous(limits=c(0, 0.8)) +
  ggtitle("baseline v RTPA1")

```

#all graphs
```{r}

plots <- list()

# Get unique values for each loop
subregions <- unique(all_data$subregion)
groups <- unique(all_data$Group)

  for (s in subregions) {
    for (r in groups) {
      subset_data <- all_data[all_data$Group == r & all_data$subregion == s, ]
      
      p <- ggplot(subset_data, aes(x = Treatment)) +
        geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 0.5) +
        geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.5) +  
        theme_classic() +
        scale_color_manual(values = c("chr" = "blue", "halo" = "orange")) +
        scale_y_continuous(limits = c(0, 0.85), expand = c(0, 0)) +
        ylab("Fraction of time on LED ON side") +
        scale_x_discrete(labels = c("Baseline Day", "Real Time Place")) +
        theme(axis.text.x = element_blank(),
              axis.ticks.x = element_blank(),
              axis.text.x.bottom = element_text(size = 10, color = "black"),
              axis.title.x = element_blank(),
              text = element_text(size = 17),
              plot.title = element_text(hjust = 0.5)) +
        ggtitle(paste("Subregion:", s, "Group:", r)) +
        guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
      
      plots <- append(plots, list(p))
    }
  }

# View all plots
for (plot in plots) {
  print(plot)
}
  
```
# Figure 4D (lat halo)
```{r}
lat_halo <- data.frame(all_data) %>% filter(genotype=="d3cre") %>% 
  filter(subregion=="lat") %>%
  filter(Group=="halo") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100) 

summary_df <- lat_halo %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (lat_halo, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "quet"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "quet"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-NpHR", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
  # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 4d.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```
#Figure 4F (lat chr)
```{r}
lat_chr <- data.frame(all_data) %>% filter(genotype=="d3cre") %>% 
  filter(subregion=="lat") %>%
  filter(Group=="chr") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- lat_chr %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (lat_chr, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "chr"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "chr"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-ChR2", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
      # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 4f.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```

#Figure 5C (med halo)
```{r}
med_halo <- data.frame(all_data) %>% dplyr::filter(genotype=="d3cre") %>% 
  dplyr::filter(subregion=="med") %>%
  dplyr::filter(Group=="halo") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- med_halo %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (med_halo, aes(x=Treatment)) +
    geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "quet"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "quet"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-NpHR", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
  # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 5c.eps", width = 5.2, height = 8,, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```
#Figure 5E (med chr)
```{r}
med_chr <- data.frame(all_data) %>% dplyr::filter(genotype=="d3cre") %>% 
  dplyr::filter(subregion=="med") %>%
  dplyr::filter(Group=="chr") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- med_chr %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (med_chr, aes(x=Treatment)) +
    geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "chr"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "chr"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-ChR2", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
  # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 5e.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```

#Figure S1A (WT lat chr)
```{r}
wt_lat <- data.frame(all_data) %>% dplyr::filter(genotype=="wt") %>% 
  dplyr::filter(subregion=="lat") %>%
  dplyr::filter(Group=="wtchr") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- wt_lat %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (wt_lat, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "wtchr"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "wtchr"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("LatSh", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig wt_lat_chr.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```

#Figure 4G (lat YFP blue)
```{r}
lat_yfpblue <- data.frame(all_data) %>% 
  dplyr::filter(subregion=="lat") %>%
  dplyr::filter(Group!="wtchr") %>%
  dplyr::filter(Group!="chr") %>%
  dplyr::filter(Group!="halo") %>%
  dplyr::filter(Group!="yfporange") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- lat_yfpblue %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (lat_yfpblue, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_line(aes(group = interaction(Mouse, Group), y = PercentageTimeLightSide, color = Group), alpha = 0.8) +
  theme_classic() +
  scale_color_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_fill_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-eYFP", width=15)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 4g.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```
#Figure 4E (lat yfp orange)
```{r}
lat_yfporange <- data.frame(all_data) %>% 
  dplyr::filter(subregion=="lat") %>%
  dplyr::filter(Group!="wtchr") %>%
  dplyr::filter(Group!="chr") %>%
  dplyr::filter(Group!="halo") %>%
  dplyr::filter(Group!="yfpblue") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- lat_yfporange %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (lat_yfporange, aes(x=Treatment)) +
 geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
          width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("yfporange" = "darkorange1", "quet"="blue2")) +
  scale_fill_manual(values = c("yfporange" = "darkorange1", "quet"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-eYFP", width=15)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 4e.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```


#export as csv
```{r}
# Define the path to the desktop
desktop_path <- "/Users/Elly/Desktop/D1 cre spark RTPP.csv"

# Write the dataframe to the CSV file
write.csv(all_data, file = desktop_path, row.names = FALSE)

```

#binning data
```{r}
percentage_bins <- data.frame()

# Create bins
all_data_bins <- all_data_xy %>%
  mutate(bin = cut(mins, breaks = 5))

# Loop through each mouse
for (current_mouse in unique(all_data_bins$Mouse)) {
  
  # Loop through each treatment for the current mouse
  for (current_treatment in unique(all_data_bins$Treatment[all_data_bins$Mouse == current_mouse])) {
    
    # Loop through each bin for the current treatment and mouse
    for (current_bin in unique(all_data_bins$bin[all_data_bins$Mouse == current_mouse & all_data_bins$Treatment == current_treatment])) {
      
      # Subset the data for the current mouse, treatment, and bin
      subset_data <- all_data_bins[all_data_bins$Mouse == current_mouse & all_data_bins$Treatment == current_treatment & all_data_bins$bin == current_bin, ]
      
      # Calculate the percentage of time on the light side for each treatment, mouse, and bin
      percentage_time_light_side_bins <- subset_data %>%
        group_by(Mouse, Treatment, bin, light_side, datemouse) %>%
        summarise(PercentageTimeLightSide = sum(current_side == light_side, na.rm = TRUE) / n(), .groups = 'drop')
      
      # Append to the main data frame
      percentage_bins <- bind_rows(percentage_bins, percentage_time_light_side_bins)
    }
  }
}


#Add a column for Group to the data frame
percentage_bins <- percentage_bins %>%
  left_join(data.frame(Mouse = names(Group), Group = Group), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(subregion), subregion = subregion), by = "Mouse") %>% 
  left_join(data.frame(Mouse = names(genotype), genotype = genotype), by = "Mouse")

percentage_bins_rtpa <- percentage_bins %>% filter(Treatment=="rtpa")  %>% filter(subregion=="lat")
ggplot(percentage_bins_rtpa, aes(x=bin, y=PercentageTimeLightSide, color=Group)) + geom_boxplot(outlier.shape=NA) +
  geom_point(aes(group=Group, fill=Group),position=position_jitterdodge(dodge.width = 0.9, jitter.width=0.2)) + 
  theme_classic() +
  geom_line(aes(group = Mouse, color = Group), alpha = 0.4) +
  scale_color_manual(values=c("blue", "orange", "green", "cornflowerblue", "brown"))
```

#Paired t tests
```{r}
t_test_results <- list()

all_data <- all_data %>% drop_na()

for (current_group in unique(all_data$Group)) {
  for (current_genotype in unique(all_data$genotype)) {
    for (current_subregion in unique(all_data$subregion)) {
      
      # Subset data for the current treatment, genotype, and drug
      subset_data <- all_data[all_data$Group == current_group & 
                                    all_data$genotype == current_genotype & 
                                    all_data$subregion == current_subregion, ]
      
      
      # Check if there are exactly two levels in the pref column
      if (length(unique(subset_data$Treatment)) == 2) {
        # Extract percent values for baseline and final
        baseline_values <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "baseline"]
        final_values <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "rtpa"]
        
        # Check if we have equal lengths for paired t-test
        if (length(baseline_values) == length(final_values)) {
          # Perform the paired t-test
          t_test_result <- t.test(baseline_values, final_values, paired = TRUE)
          
          # Store results in the list
          t_test_results[[paste(current_genotype, current_subregion, current_group, sep = "_")]] <- t_test_result
        }
      }
    }
  }
}

# Print the results
print(t_test_results)
```

#d1 spark
```{r}
sal_data <- all_data %>% filter(Group=="saline")
fent_data <- all_data %>% filter(Group=="fentanyl")

ggplot(sal_data, aes(x = Treatment)) +
        geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 0.5) +
        geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.5) +  
        theme_classic() +
        scale_color_manual(values = c("fentanyl" = "blue", "saline" = "black")) +
  # geom_text(aes(label = Mouse, y=PercentageTimeLightSide)) + 
        scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
        ylab("Fraction of time on LED ON side") +
        scale_x_discrete(labels = c("Baseline Day", "Real Time Place")) +
        theme(axis.text.x = element_blank(),
              axis.ticks.x = element_blank(),
              axis.text.x.bottom = element_text(size = 10, color = "black"),
              axis.title.x = element_blank(),
              text = element_text(size = 17),
              plot.title = element_text(hjust = 0.5)) +
        ggtitle("d1 spark mice") +
        guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color

ggplot(fent_data, aes(x = Treatment)) +
        geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 0.5) +
        geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.5) +  
        theme_classic() +
        scale_color_manual(values = c("fentanyl" = "blue", "saline" = "black")) +
  # geom_text(aes(label = Mouse, y=PercentageTimeLightSide)) + 
        scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
        ylab("Fraction of time on LED ON side") +
        scale_x_discrete(labels = c("Baseline Day", "Real Time Place")) +
        theme(axis.text.x = element_blank(),
              axis.ticks.x = element_blank(),
              axis.text.x.bottom = element_text(size = 10, color = "black"),
              axis.title.x = element_blank(),
              text = element_text(size = 17),
              plot.title = element_text(hjust = 0.5)) +
        ggtitle("d1 spark mice") +
        guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
```

#fold changes stats
```{r}
filtered_df_lat_orange <- fold_changes[fold_changes$subregion == "lat" & fold_changes$Group != "yfpblue" & fold_changes$Group != "chr" & fold_changes$genotype=="d3cre", ]

# Perform unpaired t-test between chr and halo groups for fold_change
t_test_result_lat_orange <- t.test(fold_change ~ Group, data = filtered_df_lat_orange)

# Display the t-test results
print(t_test_result_lat_orange)

filtered_df_lat_blue <- fold_changes[fold_changes$subregion == "lat" & fold_changes$Group != "yfporange" & fold_changes$Group != "halo" & fold_changes$genotype=="d3cre", ]

# Perform unpaired t-test between chr and halo groups for fold_change
t_test_result_lat_blue <- t.test(fold_change ~ Group, data = filtered_df_lat_blue)

# Display the t-test results
print(t_test_result_lat_blue)

filtered_df_med_orange <- fold_changes[fold_changes$subregion == "med" & fold_changes$Group != "yfpblue" & fold_changes$Group != "chr" & fold_changes$genotype=="d3cre", ]

# Perform unpaired t-test between chr and halo groups for fold_change
t_test_result_med_orange <- t.test(fold_change ~ Group, data = filtered_df_med_orange)

# Display the t-test results
print(t_test_result_med_orange)

filtered_df_med_blue <- fold_changes[fold_changes$subregion == "med" & fold_changes$Group != "yfporange" & fold_changes$Group != "halo" & fold_changes$genotype=="d3cre", ]

# Perform unpaired t-test between chr and halo groups for fold_change
t_test_result_med_blue <- t.test(fold_change ~ Group, data = filtered_df_med_blue)

# Display the t-test results
print(t_test_result_med_blue)
```

#Figure 5F (med yfp blue)
```{r}
med_yfpblue <- data.frame(all_data) %>% 
  dplyr::filter(subregion=="med") %>%
  dplyr::filter(Group!="wtchr") %>%
  dplyr::filter(Group!="chr") %>%
  dplyr::filter(Group!="halo") %>%
  dplyr::filter(Group!="yfporange") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- med_yfpblue %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (med_yfpblue, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_line(aes(group = interaction(Mouse, Group), y = PercentageTimeLightSide, color = Group), alpha = 0.8) +
  theme_classic() +
  scale_color_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_fill_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-eYFP", width=15)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 5f.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```


#export pdf
```{r}
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/linked figures")

# Open a PDF device with the specified dimensions
pdf("fig 4c.pdf", width = 8, height = 5.5)

# Create the plot
print(plot)

# Close the PDF device
dev.off()
```
#Figure 4C (fold change lat)
```{r}

fold_lat <- fold_changes %>%
  dplyr::filter(subregion == "lat", genotype == "d3cre") %>%
  dplyr::filter(row_number() %% 2 != 0) %>%
  mutate(fold_change=fold_change-1)

label_custom <- function(Group) {
  label_data <- data.frame(
    Group = c("halo", "yfporange", "chr", "yfpblue"),
    genotype = c("D3::Cre", "D3::Cre", "D3::Cre", "D3::Cre"),
    virus = c("NpHR", "EYFP", "ChR2", "EYFP"),
    light_color = c("Orange", "Orange", "Blue", "Blue")
  )
  
  # Create labels based on the Group levels
  labels <- label_data %>%
    filter(Group %in% Group) %>%
    mutate(label = paste(genotype, virus, light_color, sep = "\n")) %>%
    pull(label)
  
  return(labels)
}

fold_summary <- fold_lat %>%
  group_by(Group) %>%
  summarize(
    mean = mean(fold_change, na.rm = TRUE),
    sem = sd(fold_change, na.rm = TRUE) / sqrt(n()))

# Apply the custom labels to the x-axis
plot <- ggplot(fold_lat, aes(x = factor(Group, levels = c("halo", "yfporange", "chr", "yfpblue")))) +
  geom_bar(aes(y=fold_change, fill=Group, color=Group),
           alpha=0.5,
           stat ="summary",
           width=0.7) +
  geom_point(aes(y = fold_change, fill = Group, color = Group), size = 1, position= position_jitterdodge()) +
  scale_color_manual(values = c("halo" = "darkorange1", "chr" = "blue2", "yfporange" = "darkorange1", "yfpblue" = "blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "chr" = "blue2", "yfporange" = "darkorange1", "yfpblue" = "blue2")) +
  geom_errorbar(data=fold_summary, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  scale_color_manual(values = c("halo" = "darkorange1", "chr" = "blue2", "yfporange" = "darkorange1", "yfpblue" = "blue2")) +
  labs(y = "Fold Change") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 22, color = "black"),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        text = element_text(size = 25),
        axis.line = element_line(size = 1.2), 
        plot.title = element_text(hjust = 0.5, size = 26)) +
  scale_y_continuous(limits=c(-0.9, 1.2)) +
  geom_hline(yintercept = 0) +
  guides(fill = FALSE, color = FALSE) +
  scale_x_discrete(labels = label_custom(levels(factor(fold_lat$Group)))) +
  ggtitle("Relative Fold Change in Preference")

print(plot)

# Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Open an EPS device with Arial as the font family
# Open an EPS device with Arial as the font family
cairo_ps("fig 4c.eps", width = 8, height = 5.5, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the EPS device
dev.off()
```

#D1 spark stats (paired t test)
```{r}
#stats for halo and chr (paired t tests)
t_test_results <- list()

for (current_group in unique(all_data$Group)) {
      
      # Subset data for the current treatment, genotype, and drug
      subset_data <- all_data[all_data$Group == current_group, ]
      
      
      # Check if there are exactly two levels in the pref column
      if (length(unique(subset_data$Treatment)) == 2) {
        # Extract percent values for baseline and final
        baseline_values <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "baseline"]
        final_values <- subset_data$PercentageTimeLightSide[subset_data$Treatment == "rtpp"]
        
        # Check if we have equal lengths for paired t-test
        if (length(baseline_values) == length(final_values)) {
          # Perform the paired t-test
          t_test_result <- t.test(baseline_values, final_values, paired = TRUE)
          
          # Store results in the list
          t_test_results[[paste(current_group, sep = "_")]] <- t_test_result
        }
      }
    }

# Print the results
print(t_test_results)
```

#Figure 5D (med yfp orange)
```{r}
med_yfporange <- data.frame(all_data) %>% 
  dplyr::filter(subregion=="med") %>%
  dplyr::filter(Group!="wtchr") %>%
  dplyr::filter(Group!="chr") %>%
  dplyr::filter(Group!="halo") %>%
  dplyr::filter(Group!="yfpblue") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- med_yfporange %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (med_yfporange, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_line(aes(group = interaction(Mouse, Group), y = PercentageTimeLightSide, color = Group), alpha = 0.8) +
  theme_classic() +
  scale_color_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_fill_manual(values = c("yfporange" = "darkorange1", "yfpblue"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("D3::Cre + doublefloxed-eYFP", width=15)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig 5d.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```

#Figure S1B (WT med)
```{r}
wt_med <- data.frame(all_data) %>% dplyr::filter(genotype=="wt") %>% 
  dplyr::filter(subregion=="med") %>%
  dplyr::filter(Group=="wtchr") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

wt_lat <- data.frame(all_data) %>% dplyr::filter(genotype=="wt") %>% 
  dplyr::filter(subregion=="lat") %>%
  dplyr::filter(Group=="wtchr") %>%
  mutate(PercentageTimeLightSide = PercentageTimeLightSide * 100)

summary_df <- wt_med %>%
  group_by(Group, Treatment) %>%
  summarize(
    mean = mean(PercentageTimeLightSide, na.rm = TRUE),
    sem = sd(PercentageTimeLightSide, na.rm = TRUE) / sqrt(n()))

plot <- ggplot (wt_med, aes(x=Treatment)) +
  geom_bar(aes(y = PercentageTimeLightSide, fill = Group, color = Group), 
           alpha = 0.5, 
           stat = "summary", 
           fun = "mean",
           width = 0.7) +
  geom_errorbar(data=summary_df, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  geom_point(aes(y = PercentageTimeLightSide, fill = Group, color = Group), size = 2) +
  geom_path(aes(group = Mouse, y = PercentageTimeLightSide, color = Group), alpha = 0.8) +  
  theme_classic() +
  scale_color_manual(values = c("halo" = "darkorange1", "wtchr"="blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "wtchr"="blue2")) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  ylab("Percent time on light side") +
  scale_x_discrete(labels = c("Baseline", "Real Time")) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x.bottom = element_text(size = 25, color = "black"),
        axis.title.x= element_blank(),
        text = element_text(size = 25),
        plot.title = element_text(hjust = 0.5), 
        axis.line = element_line(size = 1.2)) +
  ggtitle(str_wrap("MedSh", width=25)) +
   guides(fill = FALSE, color = FALSE)  # Remove legend for fill and color
  
  print(plot)
  
    # Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Use Cairo EPS device
cairo_ps("fig wt_med_chr.eps", width = 5.2, height = 8, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the Cairo EPS device
dev.off()
```

#Figure 5B(fold change med)
```{r}
fold_med <- fold_changes %>%
  dplyr::filter(subregion == "med", genotype == "d3cre") %>%
  dplyr::filter(row_number() %% 2 != 0) %>%
  mutate(fold_change=fold_change-1)

label_custom <- function(Group) {
  label_data <- data.frame(
    Group = c("halo", "yfporange", "chr", "yfpblue"),
    genotype = c("D3::Cre", "D3::Cre", "D3::Cre", "D3::Cre"),
    virus = c("NpHR", "EYFP", "ChR2", "EYFP"),
    light_color = c("Orange", "Orange", "Blue", "Blue")
  )
  
  # Create labels based on the Group levels
  labels <- label_data %>%
    filter(Group %in% Group) %>%
    mutate(label = paste(genotype, virus, light_color, sep = "\n")) %>%
    pull(label)
  
  return(labels)
}

fold_summary <- fold_med %>%
  group_by(Group) %>%
  summarize(
    mean = mean(fold_change, na.rm = TRUE),
    sem = sd(fold_change, na.rm = TRUE) / sqrt(n()))

# Apply the custom labels to the x-axis
plot <- ggplot(fold_med, aes(x = factor(Group, levels = c("halo", "yfporange", "chr", "yfpblue")))) +
  geom_bar(aes(y=fold_change, fill=Group, color=Group),
           alpha=0.5,
           stat ="summary",
           width=0.7) +
  geom_point(aes(y = fold_change, fill = Group, color = Group), size = 1, position= position_jitterdodge()) +
  scale_color_manual(values = c("halo" = "darkorange1", "chr" = "blue2", "yfporange" = "darkorange1", "yfpblue" = "blue2")) +
  scale_fill_manual(values = c("halo" = "darkorange1", "chr" = "blue2", "yfporange" = "darkorange1", "yfpblue" = "blue2")) +
  geom_errorbar(data=fold_summary, aes(ymin = mean - sem, ymax = mean + sem, color=Group),
                width = 0.2) +
  labs(y = "Fold Change") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 22, color = "black"),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        text = element_text(size = 25),
        axis.line = element_line(size = 1.2), 
        plot.title = element_text(hjust = 0.5, size = 26)) +
  scale_y_continuous(limits=c(-0.3, 2.05)) +
  geom_hline(yintercept = 0) +
  guides(fill = FALSE, color = FALSE) +
  scale_x_discrete(labels = label_custom(levels(factor(fold_lat$Group)))) +
  ggtitle("Relative Fold Change in Preference")

print(plot)

# Set the working directory
setwd("/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/EPS files")

# Open an EPS device with Arial as the font family
cairo_ps("fig 5b.eps", width = 8, height = 5.5, family = "ArialMT", pointsize = 12)

# Create the plot
print(plot)

# Close the EPS device
dev.off()
```
#exporting raw data figure 4
```{r}
folds_lat <- fold_changes %>% filter(genotype!="wt") %>% filter(subregion=="lat")

raw_data <- createWorkbook()

fig_labels <- c("Figure 4C", "Figure 4D", "Figure 4E", "Figure 4F", "Figure 4G")

dfs_fig <- list(folds_lat, lat_halo, lat_yfporange, lat_chr, lat_yfpblue)

for (i in 1:length(fig_labels)) {
  current_df <- dfs_fig[[i]]
    
    # Add a new worksheet with the custom sheet name
    addWorksheet(raw_data, sheetName = fig_labels[i])
    
    # Write the pivoted data to the worksheet
    writeData(raw_data, sheet = fig_labels[i], current_df)
}

saveWorkbook(raw_data, "/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/writing/raw_data_fig4.xlsx", overwrite = TRUE)
```

#exporting raw data figure 5
```{r}
folds_med <- fold_changes %>% filter(genotype!="wt") %>% filter(subregion=="med")

raw_data <- createWorkbook()

fig_labels <- c("Figure 5B", "Figure 5C", "Figure 5D", "Figure 5E", "Figure 5F")

dfs_fig <- list(folds_med, med_halo, med_yfporange, med_chr, med_yfpblue)

for (i in 1:length(fig_labels)) {
  current_df <- dfs_fig[[i]]
    
    # Add a new worksheet with the custom sheet name
    addWorksheet(raw_data, sheetName = fig_labels[i])
    
    # Write the pivoted data to the worksheet
    writeData(raw_data, sheet = fig_labels[i], current_df)
}

saveWorkbook(raw_data, "/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/writing/raw_data_fig5.xlsx", overwrite = TRUE)
```

#exporting raw data supplemental
```{r}
raw_data <- createWorkbook()

fig_labels <- c("Figure S1a", "Figure S1b")

dfs_fig <- list(wt_lat, wt_med)

for (i in 1:length(fig_labels)) {
  current_df <- dfs_fig[[i]]
    
    # Add a new worksheet with the custom sheet name
    addWorksheet(raw_data, sheetName = fig_labels[i])
    
    # Write the pivoted data to the worksheet
    writeData(raw_data, sheet = fig_labels[i], current_df)
}

saveWorkbook(raw_data, "/Users/Elly/Desktop/Kim Lab-Whistler Lab/D3 Behavior Manuscript/writing/raw_data_figS1.xlsx", overwrite = TRUE)
```

